# Televibe Server

## Описание проекта
Televibe Server — это серверная часть нашего мобильного мессенджера Televibe, обеспечивающая надежное и безопасное клиент-серверное взаимодействие. Серверная часть отвечает за управление данными пользователей, обработку запросов и реализацию логики приложения, обеспечивая шифрование данных на всех этапах.

## Основные функции
- **Обработка клиентских запросов**: Реализация функционала для отправки и получения сообщений, управления чатами и пользователями.
- **Подключение к базе данных**: Использование PostgreSQL для надежного хранения данных.
- **Безопасное взаимодействие**: Использование асимметричного и симметричного шифрования для защиты данных.

## Основные компоненты и принципы работы

### Подключение к базе данных
Мы используем PostgreSQL в качестве СУБД для хранения всех данных приложения. Подключение к базе данных осуществляется с использованием библиотеки `Npgsql`. Все операции выполняются через асинхронные вызовы для обеспечения высокой производительности и отзывчивости системы.

### Обработка клиентских запросов
Сервер обрабатывает клиентские запросы, поступающие через WebSocket. Каждый запрос анализируется, и в зависимости от типа команды, выполняется соответствующее действие. Вот основные команды, которые обрабатывает сервер:

- **SendMessage**: Отправка сообщения в определенный чат.
- **ChatCreate**: Создание нового чата.
- **GetMessages**: Получение сообщений из чата.
- **RefactorMessage**: Редактирование ранее отправленного сообщения.
- **addUserToChat**: Добавление пользователя в чат.
- **DeleteMessages**: Удаление сообщений из чата.
- **DeleteChat**: Удаление чата.
- **DeleteAllMessagesFromUser**: Удаление всех сообщений от определенного пользователя.
- **AddUserData**: Добавление данных пользователя.
- **GetUserData**: Получение данных пользователя.

### Шифрование данных
Для обеспечения безопасности данных мы используем комбинацию асимметричного (RSA) и симметричного (AES) шифрования. Все сообщения шифруются на стороне клиента перед отправкой на сервер, и сервер обеспечивает хранение и передачу этих зашифрованных данных без их расшифровки, чтобы гарантировать максимальную конфиденциальность.

### Логирование
Сервер ведет подробное логирование всех операций и событий. Логи могут быть просмотрены через веб-интерфейс, что позволяет отслеживать и анализировать работу системы, а также выявлять и устранять возможные проблемы.

### Пример обработки SQL команд
Ниже представлен пример обработки SQL команд на сервере. В зависимости от команды, сервер выполняет соответствующую операцию, подключаясь к базе данных и взаимодействуя с клиентом через WebSocket.

#### Метод `ExecuteSqlCommand`
Этот метод отвечает за выполнение SQL команд. Он принимает параметры, такие как команда SQL, объект WebSocket для взаимодействия с клиентом, и выполняет соответствующие действия в зависимости от типа команды.

```csharp
public async Task ExecuteSqlCommand(Lobby lobby, WebSocket webSocket, string sqlCommand, Player player)
{
    using (var dbConnection = new NpgsqlConnection($"Host={host};Username={user};Password={password};Database={database};Port={port}"))
    {
        await dbConnection.OpenAsync();
        Console.WriteLine(dbConnection.ConnectionString);

        int senderId = player.Id;

        if (dbConnection.State != ConnectionState.Open)
        {
            Console.WriteLine("DB connection error");
            return;
        }

        try
        {
            switch (sqlCommand)
            {
                case string s when s.StartsWith("SendMessage"):
                    await Task.Run(() => SendMessage(sqlCommand, senderId, dbConnection, lobby, webSocket));
                    break;
                // Другие команды обрабатываются аналогично
                default:
                    Console.WriteLine("Command not found");
                    break;
            }
        }
        catch (Exception e)
        {
            Console.WriteLine($"Error executing SQL command: {e}");
        }
    }
}
```

## Используемые технологии
- **.NET**: Платформа для разработки серверной части.
- **PostgreSQL**: СУБД для хранения данных.
- **WebSocket**: Протокол для реализации клиент-серверного взаимодействия в реальном времени.
- **Npgsql**: Библиотека для подключения к PostgreSQL из .NET приложений.
- **RSA, AES**: Алгоритмы шифрования для обеспечения безопасности данных.

## Заключение
Серверная часть Televibe обеспечивает надежное и безопасное взаимодействие клиентов с сервером, используя передовые методы шифрования и надежную СУБД. Мы стремимся к постоянному улучшению производительности и безопасности нашего сервера, чтобы обеспечить пользователям наилучший опыт общения.
